import React, { useState, useEffect } from 'react';
import { 
  LayoutDashboard, 
  ShoppingBag, 
  Package, 
  Users, 
  Table as TableIcon, 
  BarChart3, 
  Settings, 
  Bell, 
  Search, 
  Menu, 
  ChevronRight, 
  MoreVertical,
  AlertCircle,
  Plus,
  Filter,
  ArrowUpRight,
  ChevronDown,
  LogOut,
  MapPin
} from 'lucide-react';

/**
 * CORE DESIGN SYSTEM CONSTANTS
 */
const COLORS = {
  primary: 'indigo-600',
  secondary: 'slate-600',
  success: 'emerald-500',
  warning: 'amber-500',
  danger: 'rose-500',
  bg: 'bg-slate-50',
  card: 'bg-white',
  border: 'border-slate-200'
};

const App = () => {
  const [activeTab, setActiveTab] = useState('dashboard');
  const [isSidebarOpen, setSidebarOpen] = useState(true);
  const [notifications, setNotifications] = useState(3);

  // Mock Data
  const stats = [
    { label: 'Orders Today', value: '142', icon: ShoppingBag, color: 'text-blue-600', bg: 'bg-blue-50' },
    { label: 'Revenue', value: '$4,280.50', icon: ArrowUpRight, color: 'text-emerald-600', bg: 'bg-emerald-50' },
    { label: 'Active Tables', value: '12/20', icon: TableIcon, color: 'text-indigo-600', bg: 'bg-indigo-50' },
    { label: 'Low Stock', value: '5 Items', icon: AlertCircle, color: 'text-rose-600', bg: 'bg-rose-50' },
  ];

  const recentOrders = [
    { id: '#8842', table: 'T-04', items: 3, total: '$45.00', status: 'Preparing', type: 'Dine-in', time: '5m ago' },
    { id: '#8841', table: 'T-12', items: 1, total: '$12.50', status: 'Ready', type: 'Takeaway', time: '12m ago' },
    { id: '#8840', table: 'T-08', items: 5, total: '$112.00', status: 'Pending', type: 'Dine-in', time: '15m ago' },
    { id: '#8839', table: 'Del-01', items: 2, total: '$38.20', status: 'Preparing', type: 'Delivery', time: '22m ago' },
  ];

  const inventoryItems = [
    { name: 'Organic Roma Tomato', category: 'Vegetables', stock: '2.4 kg', min: '5.0 kg', status: 'Low' },
    { name: 'Whole Milk 3.5%', category: 'Dairy', stock: '12 L', min: '10 L', status: 'Good' },
    { name: 'Brioche Buns', category: 'Bakery', stock: '15 pcs', min: '40 pcs', status: 'Critical' },
    { name: 'Chicken Breast', category: 'Meat', stock: '18 kg', min: '10 kg', status: 'Good' },
  ];

  // UI Components
  const StatusBadge = ({ status }) => {
    const styles = {
      'Preparing': 'bg-blue-100 text-blue-700',
      'Ready': 'bg-emerald-100 text-emerald-700',
      'Pending': 'bg-amber-100 text-amber-700',
      'Completed': 'bg-slate-100 text-slate-700',
      'Low': 'bg-amber-100 text-amber-700',
      'Critical': 'bg-rose-100 text-rose-700',
      'Good': 'bg-emerald-100 text-emerald-700',
    };
    return (
      <span className={`px-3 py-1 rounded-full text-xs font-semibold ${styles[status] || 'bg-gray-100 text-gray-700'}`}>
        {status}
      </span>
    );
  };

  const SidebarItem = ({ id, icon: Icon, label }) => (
    <button
      onClick={() => setActiveTab(id)}
      className={`w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200 ${
        activeTab === id 
          ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-200' 
          : 'text-slate-500 hover:bg-slate-100 hover:text-slate-900'
      }`}
    >
      <Icon size={20} />
      {isSidebarOpen && <span className="font-medium">{label}</span>}
    </button>
  );

  return (
    <div className={`flex h-screen ${COLORS.bg} font-sans text-slate-900 antialiased overflow-hidden`}>
      
      {/* SIDEBAR */}
      <aside className={`${isSidebarOpen ? 'w-64' : 'w-20'} border-r ${COLORS.border} bg-white transition-all duration-300 flex flex-col`}>
        <div className="p-6 flex items-center space-x-3">
          <div className="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white shrink-0 shadow-inner">
            <LayoutDashboard size={24} />
          </div>
          {isSidebarOpen && <span className="text-xl font-bold tracking-tight">Lumina<span className="text-indigo-600">POS</span></span>}
        </div>

        <nav className="flex-1 px-3 space-y-1">
          <SidebarItem id="dashboard" icon={LayoutDashboard} label="Dashboard" />
          <SidebarItem id="orders" icon={ShoppingBag} label="Orders" />
          <SidebarItem id="tables" icon={TableIcon} label="Tables" />
          <SidebarItem id="inventory" icon={Package} label="Inventory" />
          <SidebarItem id="staff" icon={Users} label="Staff" />
          <SidebarItem id="reports" icon={BarChart3} label="Reports" />
          <div className="pt-4 pb-2">
            <div className={`h-px bg-slate-100 mx-4 mb-4`} />
            <SidebarItem id="settings" icon={Settings} label="Settings" />
          </div>
        </nav>

        <div className="p-4 border-t border-slate-100">
          <button className="flex items-center space-x-3 text-slate-500 hover:text-rose-600 p-2 w-full transition-colors">
            <LogOut size={20} />
            {isSidebarOpen && <span className="font-medium">Sign Out</span>}
          </button>
        </div>
      </aside>

      {/* MAIN CONTENT AREA */}
      <main className="flex-1 flex flex-col overflow-hidden">
        
        {/* HEADER */}
        <header className="h-20 bg-white border-b border-slate-200 px-8 flex items-center justify-between shrink-0">
          <div className="flex items-center space-x-4">
            <button 
              onClick={() => setSidebarOpen(!isSidebarOpen)}
              className="p-2 hover:bg-slate-100 rounded-lg text-slate-500 md:block hidden"
            >
              <Menu size={20} />
            </button>
            <div className="flex flex-col">
              <h1 className="text-lg font-bold capitalize">{activeTab}</h1>
              <div className="flex items-center text-xs text-slate-400">
                <MapPin size={12} className="mr-1" />
                <span>Downtown Branch (Main)</span>
              </div>
            </div>
          </div>

          <div className="flex items-center space-x-6">
            <div className="relative hidden lg:block">
              <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" size={18} />
              <input 
                type="text" 
                placeholder="Search orders, items..." 
                className="pl-10 pr-4 py-2 bg-slate-100 border-none rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 w-64 outline-none transition-all"
              />
            </div>
            
            <button className="relative p-2 text-slate-500 hover:bg-slate-100 rounded-full transition-colors">
              <Bell size={22} />
              {notifications > 0 && (
                <span className="absolute top-1 right-1 w-4 h-4 bg-rose-500 border-2 border-white rounded-full text-[10px] text-white flex items-center justify-center font-bold">
                  {notifications}
                </span>
              )}
            </button>

            <div className="flex items-center space-x-3 pl-4 border-l border-slate-200">
              <div className="text-right hidden sm:block">
                <p className="text-sm font-semibold">Alex Rivers</p>
                <p className="text-xs text-slate-400 uppercase tracking-wider font-bold">Manager</p>
              </div>
              <div className="w-10 h-10 rounded-full bg-slate-200 border-2 border-white shadow-sm overflow-hidden">
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Alex" alt="User" />
              </div>
            </div>
          </div>
        </header>

        {/* VIEW PORT */}
        <div className="flex-1 overflow-y-auto p-8 custom-scrollbar">
          
          {activeTab === 'dashboard' && (
            <div className="max-w-7xl mx-auto space-y-8 animate-in fade-in duration-500">
              
              {/* STATS GRID */}
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                {stats.map((stat, idx) => (
                  <div key={idx} className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition-shadow group">
                    <div className="flex items-center justify-between mb-4">
                      <div className={`${stat.bg} ${stat.color} p-3 rounded-xl group-hover:scale-110 transition-transform`}>
                        <stat.icon size={24} />
                      </div>
                      <button className="text-slate-300 hover:text-slate-600 transition-colors">
                        <MoreVertical size={18} />
                      </button>
                    </div>
                    <p className="text-slate-500 text-sm font-medium">{stat.label}</p>
                    <h3 className="text-2xl font-bold mt-1">{stat.value}</h3>
                  </div>
                ))}
              </div>

              {/* MAIN DASHBOARD CONTENT */}
              <div className="grid grid-cols-1 xl:grid-cols-3 gap-8">
                
                {/* RECENT ORDERS TABLE */}
                <div className="xl:col-span-2 bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                  <div className="p-6 border-b border-slate-50 flex items-center justify-between">
                    <h2 className="text-lg font-bold">Live Orders</h2>
                    <div className="flex space-x-2">
                      <button className="flex items-center space-x-2 px-3 py-1.5 border border-slate-200 rounded-lg text-sm hover:bg-slate-50 transition-colors">
                        <Filter size={14} />
                        <span>Filter</span>
                      </button>
                      <button className="flex items-center space-x-2 px-3 py-1.5 bg-indigo-600 text-white rounded-lg text-sm hover:bg-indigo-700 transition-colors shadow-sm">
                        <Plus size={14} />
                        <span>New Order</span>
                      </button>
                    </div>
                  </div>
                  <div className="overflow-x-auto">
                    <table className="w-full text-left">
                      <thead>
                        <tr className="bg-slate-50 text-slate-400 text-xs uppercase tracking-wider">
                          <th className="px-6 py-4 font-semibold">Order ID</th>
                          <th className="px-6 py-4 font-semibold">Location</th>
                          <th className="px-6 py-4 font-semibold">Status</th>
                          <th className="px-6 py-4 font-semibold">Amount</th>
                          <th className="px-6 py-4 font-semibold text-right">Actions</th>
                        </tr>
                      </thead>
                      <tbody className="divide-y divide-slate-50">
                        {recentOrders.map((order) => (
                          <tr key={order.id} className="hover:bg-slate-50 transition-colors group">
                            <td className="px-6 py-4">
                              <div className="font-bold">{order.id}</div>
                              <div className="text-xs text-slate-400">{order.time}</div>
                            </td>
                            <td className="px-6 py-4">
                              <div className="font-medium">{order.table}</div>
                              <div className="text-xs px-2 py-0.5 bg-slate-100 rounded w-fit mt-1 text-slate-500 uppercase font-bold text-[10px]">{order.type}</div>
                            </td>
                            <td className="px-6 py-4">
                              <StatusBadge status={order.status} />
                            </td>
                            <td className="px-6 py-4 font-bold text-slate-700">{order.total}</td>
                            <td className="px-6 py-4 text-right">
                              <button className="p-2 text-slate-400 hover:text-indigo-600 transition-colors">
                                <ChevronRight size={20} />
                              </button>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                  <div className="p-4 bg-slate-50 text-center">
                    <button className="text-indigo-600 text-sm font-semibold hover:underline">View all orders</button>
                  </div>
                </div>

                {/* INVENTORY ALERTS */}
                <div className="bg-white rounded-2xl shadow-sm border border-slate-100 flex flex-col">
                  <div className="p-6 border-b border-slate-50 flex items-center justify-between">
                    <h2 className="text-lg font-bold">Inventory Watch</h2>
                    <span className="bg-rose-100 text-rose-600 text-xs font-bold px-2 py-1 rounded">Alerts: 3</span>
                  </div>
                  <div className="p-4 flex-1 space-y-4">
                    {inventoryItems.map((item, idx) => (
                      <div key={idx} className="p-4 rounded-xl border border-slate-100 flex items-center justify-between hover:border-indigo-100 transition-colors">
                        <div>
                          <p className="font-bold text-sm">{item.name}</p>
                          <p className="text-xs text-slate-400">{item.category}</p>
                        </div>
                        <div className="text-right">
                          <p className={`font-bold text-sm ${item.status === 'Critical' ? 'text-rose-500' : item.status === 'Low' ? 'text-amber-500' : 'text-slate-700'}`}>
                            {item.stock}
                          </p>
                          <StatusBadge status={item.status} />
                        </div>
                      </div>
                    ))}
                  </div>
                  <div className="p-6">
                    <button className="w-full py-3 bg-slate-900 text-white rounded-xl font-bold hover:bg-slate-800 transition-colors shadow-lg">
                      Restock Items
                    </button>
                  </div>
                </div>

              </div>
            </div>
          )}

          {activeTab !== 'dashboard' && (
            <div className="flex flex-col items-center justify-center h-full text-slate-400 space-y-4 animate-in fade-in slide-in-from-bottom-4">
              <div className="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center">
                <Search size={40} />
              </div>
              <h3 className="text-xl font-bold text-slate-600">{activeTab.charAt(0).toUpperCase() + activeTab.slice(1)} Module</h3>
              <p className="text-sm max-w-xs text-center">This section is part of the next phase. The modular architecture is ready to display your detailed {activeTab} information.</p>
              <button 
                onClick={() => setActiveTab('dashboard')}
                className="px-6 py-2 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700"
              >
                Return to Dashboard
              </button>
            </div>
          )}

        </div>
      </main>

      {/* QUICK ACTION FLOATING BUTTON (Mobile/Tablet Friendly) */}
      <button className="fixed bottom-8 right-8 w-16 h-16 bg-indigo-600 text-white rounded-full shadow-2xl flex items-center justify-center hover:scale-110 active:scale-95 transition-all lg:hidden">
        <Plus size={32} />
      </button>

      {/* STYLES */}
      <style dangerouslySetInnerHTML={{ __html: `
        .custom-scrollbar::-webkit-scrollbar {
          width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: #e2e8f0;
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: #cbd5e1;
        }
      `}} />
    </div>
  );
};

export default App;
